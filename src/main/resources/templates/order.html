<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cookiegram Bakery â€“ Giant Cookie, Custom Message</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
        crossorigin="anonymous">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

  <link rel="stylesheet" th:href="@{/css/styles.css}">
  <script>
    (function() {
      const theme = localStorage.getItem('theme');
      if (theme === 'dark') {
        document.documentElement.classList.add('dark-mode');
      }
    })();
  </script>
  
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f8f9fa; /* Light gray background */
    }
    
    .nav-glass {
      /* Glassmorphism effect for the navbar */
      background-color: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    
    /* Makes the 'Choose a color...' placeholder muted gray */
    select:required:invalid {
      color: #6c757d;
    }
    
    /* Add padding to the main content to avoid navbar/footer overlap */
    main {
      padding-top: 7rem;  /* Space for fixed-top navbar */
      padding-bottom: 7rem; /* Space for footer */
    }
  </style>
</head>

<body>

  <div th:replace="fragments/nav :: mainNav"></div>

  <div class="position-fixed top-0 start-50 translate-middle-x p-3" style="z-index:1080;"
       th:if="${cartSuccess}">
    <div class="toast align-items-center text-bg-success border-0 show" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body">
          <i class="bi bi-check-circle-fill me-2"></i>
          <span th:text="${cartSuccess}">Item added to cart!</span>
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
  </div>
  
  <div class="position-fixed top-0 start-50 translate-middle-x p-3" style="z-index:1080;"
       th:if="${cartError}">
    <div class="toast align-items-center text-bg-danger border-0 show" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body">
          <i class="bi bi-exclamation-triangle-fill me-2"></i>
          <span th:text="${cartError}">Error adding item.</span>
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
  </div>

  
  <main class="container">
    
    <div class="row g-5 align-items-center">

      <div class="col-lg-7 content-center">
          <img th:src="@{/images/yourmessagehere-yellow-2022.png}"
               class="img-fluid mx-auto d-block" 
               alt="A large, delicious chocolate chip cookie ready for a custom message.">
      </div>

      <div class="col-lg-5">
        <div class="card border-0 shadow-sm rounded-3">
          <div class="card-body p-4 p-md-5">
            
            <h1 class="h2 fw-bold">Large Cookiegram</h1>
            <p class="h3 fw-light text-primary mb-3">$34.99</p>
            <p class="text-muted mb-4">
              Our famous 12-inch giant chocolate chip cookie, ready to be personalized
              with your custom message and favorite icing color.
            </p>

            <form th:action="@{/add-to-cart}" method="POST" id="orderForm">
                
                <input type="hidden" name="productId" value="COOKIE_LARGE_CC">
                <input type="hidden" name="productName" value="Large Cookiegram">
                <input type="hidden" name="price" value="34.99">
                <input type="hidden" name="itemId" th:if="${editingItem}" th:value="${editingItem.id}">
                <input type="hidden" name="orderId" th:if="${orderId}" th:value="${orderId}">

                <div class="mb-3">
                  <label for="cookieMessage" class="form-label fw-bold">Your Custom Message</label>
                  
                  <textarea class="form-control"
                            th:classappend="${cartError} ? 'is-invalid'"
                            id="cookieMessage" 
                            name="cookieMessage" 
                            rows="3"
                            placeholder="e.g., Happy Birthday, Alex!"
                            maxlength="50"
                            required th:text="${lastMessage ?: ''}"></textarea>
                  <small class="form-text text-muted" id="charCounter">
                    0 / 50 characters
                  </small>
                </div>

                <div class="mb-4">
                  <label for="icingColor" class="form-label fw-bold">Icing Color</label>
                  <select class="form-select form-select-lg" id="icingColor" name="icingColor" required
                          onchange="this.style.color = this.options[this.selectedIndex].style.color || 'inherit'"
                          style="color: inherit;">
                    
                    <option value="" selected disabled>Choose a color...</option>
                    <option value="white" style="color: inherit;" th:selected="${lastColor == 'classicwhite'}">Classic White</option>
                    <option value="pink" style="color: hotpink;" th:selected="${lastColor == 'prettypink'}">Pretty Pink</option>
                    <option value="red" style="color: red;" th:selected="${lastColor == 'vibrantred'}">Vibrant Red</option>
                    <option value="blue" style:color="blue;" th:selected="${lastColor == 'coolblue'}">Cool Blue</option>
                    <option value="green" style="color: green;" th:selected="${lastColor == 'festivegreen'}">Festive Green</option>
                    <option value="chocolate" style="color: inherit;" th:selected="${lastColor == 'chocolate'}">Chocolate</option>
                  </select>
                </div>

                <div class="d-grid gap-2">
                  <button type="submit" class="btn btn-primary btn-lg w-100 shadow">
                    <i class="bi bi-cart-plus me-2"></i>
                    <span th:if="${editingItem}">Update Item</span>
                    <span th:unless="${editingItem}">Add to Cart</span>
                  </button>
                  <a th:if="${orderId == null}" th:href="@{/cart}" class="btn btn-secondary btn-lg w-100">
                    <i class="bi bi-cart me-2"></i>
                    Proceed to Cart
                  </a>
                  <a th:if="${orderId != null}" th:href="@{|/order/edit/${orderId}|}" class="btn btn-secondary btn-lg w-100">
                    <i class="bi bi-arrow-left me-2"></i>
                    Back to Order
                  </a>
                </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </main>
  

  <div th:replace="fragments/footer :: mainFooter"></div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
          crossorigin="anonymous"></script>
  
  <script th:src="@{/js/scripts.js}"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
        
        // --- Get Elements ---
        const messageInput = document.getElementById('cookieMessage');
        const charCounter = document.getElementById('charCounter');
        const maxLength = 50; 

        // --- Character Counter Logic ---
        if (messageInput && charCounter) {
            // Function to update counter
            const updateCounter = () => {
                const currentLength = messageInput.value.length;
                charCounter.textContent = `${currentLength} / ${maxLength} characters`;
                if (currentLength >= maxLength) {
                    charCounter.classList.add('text-danger');
                } else {
                    charCounter.classList.remove('text-danger');
                }
            };
            
            // Run on input
            messageInput.addEventListener('input', updateCounter);
            
            // Run on page load (in case of repopulated text)
            updateCounter();
        }
        
        // --- Auto-hide Toasts (both success and error) ---
        const allToasts = document.querySelectorAll('.toast.show');
        allToasts.forEach(toastEl => {
             setTimeout(() => {
                 const toastInstance = bootstrap.Toast.getOrCreateInstance(toastEl);
                 setTimeout(() => {
                     toastInstance.hide();
                 }, 5000); // Hide after 5 seconds
             }, 100);
        });
    });
  </script>
</body>
</html>